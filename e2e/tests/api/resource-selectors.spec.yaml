system:
  name: "{{ prefix }}-selectors"
  slug: "{{ prefix }}-selectors"
  description: System for testing resource selectors

environments:
  - name: Production
    description: Production environment
    metadata:
      env: prod
      tier: production
    resourceSelector:
      type: comparison
      operator: and
      conditions:
        - type: metadata
          operator: equals
          key: system
          value: "{{ prefix }}-selectors"
        - type: metadata
          operator: equals
          key: env
          value: prod

  - name: Staging
    description: Staging environment
    metadata:
      env: staging
      tier: pre-production
    resourceSelector:
      type: comparison
      operator: and
      conditions:
        - type: metadata
          operator: equals
          key: system
          value: "{{ prefix }}-selectors"
        - type: metadata
          operator: equals
          key: env
          value: staging

resources:
  - name: Production Resource A
    kind: TestResource
    identifier: selector-prod-resource-a
    version: test/v1
    config:
      enabled: true
    metadata:
      system: "{{ prefix }}-selectors"
      env: prod
      type: a

  - name: Production Resource B
    kind: TestResource
    identifier: selector-prod-resource-b
    version: test/v1
    config:
      enabled: true
    metadata:
      system: "{{ prefix }}-selectors"
      env: prod
      type: b

  - name: Staging Resource A
    kind: TestResource
    identifier: selector-staging-resource-a
    version: test/v1
    config:
      enabled: true
    metadata:
      system: "{{ prefix }}-selectors"
      env: staging
      type: a

  - name: Staging Resource B
    kind: TestResource
    identifier: selector-staging-resource-b
    version: test/v1
    config:
      enabled: true
    metadata:
      system: "{{ prefix }}-selectors"
      env: staging
      type: b

deployments:
  - name: Type A Deployment
    slug: type-a-deployment
    description: Deployment for type A resources
    resourceSelector:
      system: "{{ prefix }}-selectors"
      type: metadata
      operator: equals
      key: type
      value: a

  - name: Type B Deployment
    slug: type-b-deployment
    description: Deployment for type B resources
    resourceSelector:
      system: "{{ prefix }}-selectors"
      type: metadata
      operator: equals
      key: type
      value: b

  - name: Complex Selector Deployment
    slug: complex-selector-deployment
    description: Deployment with complex resource selector
    resourceSelector:
      system: "{{ prefix }}-selectors"
      type: comparison
      operator: and
      conditions:
        - type: metadata
          operator: equals
          key: system
          value: "{{ prefix }}-selectors"
        - type: metadata
          operator: equals
          key: env
          value: prod
        - type: metadata
          operator: equals
          key: type
          value: a

policies:
  - name: Production Deployment Policy
    targets:
      - environmentSelector:
          type: comparison
          operator: and
          conditions:
            - type: metadata
              operator: equals
              key: system
              value: "{{ prefix }}-selectors"
            - type: metadata
              operator: equals
              key: tier
              value: production
